###This list adapted from UI_icons.h
#needs to be 780 items long. starts at bottom left
import bpy
import math
import bgl

icon_list = ["NONE",
"QUESTION",
"ERROR",
"CANCEL",
"TRIA_RIGHT",
"TRIA_DOWN",
"TRIA_LEFT",
"TRIA_UP",
"ARROW_LEFTRIGHT",
"PLUS",
"DISCLOSURE_TRI_DOWN",
"DISCLOSURE_TRI_RIGHT",
"RADIOBUT_OFF",
"RADIOBUT_ON",
"MENU_PANEL",
"BLENDER",
"BLANK003",
"DOT",
"BLANK004",
"X",
"BLANK005",
"GO_LEFT",
"PLUG",
"UI",
"NODE",
"NODE_SEL",
"FULLSCREEN",
"SPLITSCREEN",
"RIGHTARROW_THIN",
"BORDERMOVE",
"VIEWZOOM",
"ZOOMIN",
"ZOOMOUT",
"PANEL_CLOSE",
"COPY_ID", 
"EYEDROPPER",
"LINK_AREA", 
"AUTO",
"CHECKBOX_DEHLT",
"CHECKBOX_HLT",
"UNLOCKED",
"LOCKED",
"UNPINNED",
"PINNED",
"SCREEN_BACK",
"RIGHTARROW",
"DOWNARROW_HLT",
"DOTSUP",
"DOTSDOWN",
"LINK",
"INLINK",
"PLUGIN",
"HELP",
"GHOST_ENABLED",
"COLOR",
"LINKED",
"UNLINKED",
"HAND",
"ZOOM_ALL",
"ZOOM_SELECTED",
"ZOOM_PREVIOUS",
"ZOOM_IN",
"ZOOM_OUT",
"RENDER_REGION",
"BORDER_RECT",
"BORDER_LASSO",
"FREEZE",
"STYLUS_PRESSURE",
"GHOST_DISABLED",
"NEW",
"FILE_TICK",
"QUIT",
"URL",
"RECOVER_LAST",
"BLANK038",
"FULLSCREEN_ENTER",
"FULLSCREEN_EXIT",
"BLANK1",
"LAMP",
"MATERIAL",
"TEXTURE",
"ANIM",
"WORLD",
"SCENE",
"EDIT",
"GAME",
"RADIO",
"SCRIPT",
"PARTICLES",
"PHYSICS",
"SPEAKER",
"TEXTURE_SHADED",
"BLANK042",
"BLANK043",
"BLANK044",
"BLANK045",
"BLANK046",
"BLANK047",
"BLANK048",
"BLANK049",
"BLANK050",
"BLANK051",
"BLANK052",
"BLANK052b",
"VIEW3D",
"IPO",
"OOPS",
"BUTS",
"FILESEL",
"IMAGE_COL",
"INFO",
"SEQUENCE",
"TEXT",
"IMASEL",
"SOUND",
"ACTION",
"NLA",
"SCRIPTWIN",
"TIME",
"NODETREE",
"LOGIC",
"CONSOLE",
"PREFERENCES",
"CLIP",
"ASSET_MANAGER",
"BLANK057",
"BLANK058",
"BLANK059",
"BLANK060",
"BLANK061",
"OBJECT_DATAMODE",
"EDITMODE_HLT",
"FACESEL_HLT",
"VPAINT_HLT",
"TPAINT_HLT",
"WPAINT_HLT",
"SCULPTMODE_HLT",
"POSE_HLT",
"PARTICLEMODE",
"LIGHTPAINT",
"BLANK063",
"BLANK064",
"BLANK065",
"BLANK066",
"BLANK067",
"BLANK068",
"BLANK069",
"BLANK070",
"BLANK071",
"BLANK072",
"BLANK073",
"BLANK074",
"BLANK075",
"BLANK076",
"BLANK077",
"BLANK077b",
"SCENE_DATA",
"RENDERLAYERS",
"WORLD_DATA",
"OBJECT_DATA",
"MESH_DATA",
"CURVE_DATA",
"META_DATA",
"LATTICE_DATA",
"LAMP_DATA",
"MATERIAL_DATA",
"TEXTURE_DATA",
"ANIM_DATA",
"CAMERA_DATA",
"PARTICLE_DATA",
"LIBRARY_DATA_DIRECT",
"GROUP",
"ARMATURE_DATA",
"POSE_DATA",
"BONE_DATA",
"CONSTRAINT",
"SHAPEKEY_DATA",
"CONSTRAINT_BONE",
"BLANK079",
"PACKAGE",
"UGLYPACKAGE",
"BLANK079b",
"BRUSH_DATA",
"IMAGE_DATA",
"FILE",
"FCURVE",
"FONT_DATA",
"RENDER_RESULT",
"SURFACE_DATA",
"EMPTY_DATA",
"SETTINGS",
"RENDER_ANIMATION",
"RENDER_STILL",
"BLANK080F",
"BOIDS",
"STRANDS",
"LIBRARY_DATA_INDIRECT",
"GREASEPENCIL",
"BLANK083",
"BLANK084",
"GROUP_BONE",
"GROUP_VERTEX",
"GROUP_VCOL",
"GROUP_UVS",
"BLANK089",
"BLANK090",
"RNA",
"RNA_ADD",
"BLANK092",
"BLANK093",
"BLANK094",
"BLANK095",
"BLANK096",
"BLANK097",
"BLANK098",
"BLANK099",
"BLANK100",
"BLANK101",
"BLANK102",
"BLANK103",
"BLANK104",
"BLANK105",
"BLANK106",
"BLANK107",
"BLANK108",
"BLANK109",
"BLANK110",
"BLANK111",
"BLANK112",
"BLANK113",
"BLANK114",
"BLANK115",
"BLANK116",
"BLANK116b",
"OUTLINER_OB_EMPTY",
"OUTLINER_OB_MESH",
"OUTLINER_OB_CURVE",
"OUTLINER_OB_LATTICE",
"OUTLINER_OB_META",
"OUTLINER_OB_LAMP",
"OUTLINER_OB_CAMERA",
"OUTLINER_OB_ARMATURE",
"OUTLINER_OB_FONT",
"OUTLINER_OB_SURFACE",
"OUTLINER_OB_SPEAKER",
"BLANK120",
"BLANK121",
"BLANK122",
"BLANK123",
"BLANK124",
"BLANK125",
"BLANK126",
"BLANK127",
"RESTRICT_VIEW_OFF",
"RESTRICT_VIEW_ON",
"RESTRICT_SELECT_OFF",
"RESTRICT_SELECT_ON",
"RESTRICT_RENDER_OFF",
"RESTRICT_RENDER_ON",
"BLANK127b",
"OUTLINER_DATA_EMPTY",
"OUTLINER_DATA_MESH",
"OUTLINER_DATA_CURVE",
"OUTLINER_DATA_LATTICE",
"OUTLINER_DATA_META",
"OUTLINER_DATA_LAMP",
"OUTLINER_DATA_CAMERA",
"OUTLINER_DATA_ARMATURE",
"OUTLINER_DATA_FONT",
"OUTLINER_DATA_SURFACE",
"OUTLINER_DATA_SPEAKER",
"OUTLINER_DATA_POSE",
"BLANK130",
"BLANK131",
"BLANK132",
"BLANK133",
"BLANK134",
"BLANK135",
"BLANK136",
"BLANK137",
"BLANK138",
"BLANK139",
"BLANK140",
"BLANK141",
"BLANK142",
"BLANK142b",
"MESH_PLANE",
"MESH_CUBE",
"MESH_CIRCLE",
"MESH_UVSPHERE",
"MESH_ICOSPHERE",
"MESH_GRID",
"MESH_MONKEY",
"MESH_CYLINDER",
"MESH_TORUS",
"MESH_CONE",
"BLANK610",
"BLANK611",
"LAMP_POINT",
"LAMP_SUN",
"LAMP_SPOT",
"LAMP_HEMI",
"LAMP_AREA",
"BLANK617",
"BLANK618",
"META_EMPTY",
"META_PLANE",
"META_CUBE",
"META_BALL",
"META_ELLIPSOID",
"META_CAPSULE",
"BLANK625",
"SURFACE_NCURVE",
"SURFACE_NCIRCLE",
"SURFACE_NSURFACE",
"SURFACE_NCYLINDER",
"SURFACE_NSPHERE",
"SURFACE_NTORUS",
"BLANK636",
"BLANK637",
"BLANK638",
"CURVE_BEZCURVE",
"CURVE_BEZCIRCLE",
"CURVE_NCURVE",
"CURVE_NCIRCLE",
"CURVE_PATH",
"BLANK644",
"BLANK645",
"BLANK646",
"BLANK647",
"BLANK648",
"BLANK649",
"BLANK650",
"BLANK651",
"BLANK652",
"BLANK653",
"BLANK654",
"BLANK655",
"FORCE_FORCE",
"FORCE_WIND",
"FORCE_VORTEX",
"FORCE_MAGNETIC",
"FORCE_HARMONIC",
"FORCE_CHARGE",
"FORCE_LENNARDJONES",
"FORCE_TEXTURE",
"FORCE_CURVE",
"FORCE_BOID",
"FORCE_TURBULENCE",
"FORCE_DRAG",
"BLANK672",
"BLANK673",
"BLANK674",
"BLANK675",
"BLANK676",
"BLANK677",
"BLANK678",
"BLANK679",
"BLANK680",
"BLANK681",
"BLANK682",
"BLANK683",
"BLANK684",
"BLANK685",
"BLANK690",
"BLANK691",
"BLANK692",
"BLANK693",
"BLANK694",
"BLANK695",
"BLANK696",
"BLANK697",
"BLANK698",
"BLANK699",
"BLANK700",
"BLANK701",
"BLANK702",
"BLANK703",
"BLANK704",
"BLANK705",
"BLANK706",
"BLANK707",
"BLANK708",
"BLANK709",
"BLANK710",
"BLANK711",
"BLANK712",
"BLANK713",
"BLANK714",
"BLANK715",
"BLANK720",
"BLANK721",
"BLANK722",
"BLANK733",
"BLANK734",
"BLANK735",
"BLANK736",
"BLANK737",
"BLANK738",
"BLANK739",
"BLANK740",
"BLANK741",
"BLANK742",
"BLANK743",
"BLANK744",
"BLANK745",
"BLANK746",
"BLANK747",
"BLANK748",
"BLANK749",
"BLANK750",
"BLANK751",
"BLANK752",
"BLANK753",
"BLANK754",
"BLANK755",
"BLANK760",
"BLANK761",
"BLANK762",
"BLANK763",
"BLANK764",
"BLANK765",
"BLANK766",
"BLANK767",
"BLANK768",
"BLANK769",
"BLANK770",
"BLANK771",
"BLANK772",
"BLANK773",
"BLANK774",
"BLANK775",
"BLANK776",
"BLANK777",
"BLANK778",
"BLANK779",
"BLANK780",
"BLANK781",
"BLANK782",
"BLANK783",
"BLANK784",
"BLANK785",
"MODIFIER",
"MOD_WAVE",
"MOD_BUILD",
"MOD_DECIM",
"MOD_MIRROR",
"MOD_SOFT",
"MOD_SUBSURF",
"HOOK",
"MOD_PHYSICS",
"MOD_PARTICLES",
"MOD_BOOLEAN",
"MOD_EDGESPLIT",
"MOD_ARRAY",
"MOD_UVPROJECT",
"MOD_DISPLACE",
"MOD_CURVE",
"MOD_LATTICE",
"CONSTRAINT_DATA",
"MOD_ARMATURE",
"MOD_SHRINKWRAP",
"MOD_CAST",
"MOD_MESHDEFORM",
"MOD_BEVEL",
"MOD_SMOOTH",
"MOD_SIMPLEDEFORM",
"MOD_MASK",
"MOD_CLOTH",
"MOD_EXPLODE",
"MOD_FLUIDSIM",
"MOD_MULTIRES",
"MOD_SMOKE",
"MOD_SOLIDIFY",
"MOD_SCREW",
"MOD_VERTEX_WEIGHT",
"MOD_DYNAMICPAINT",
"MOD_REMESH",
"MOD_OCEAN",
"MOD_WARP",
"MOD_SKIN",
"BLANK166",
"BLANK167",
"BLANK168",
"BLANK169",
"BLANK170",
"BLANK171",
"BLANK172",
"BLANK173",
"BLANK174",
"BLANK175",
"BLANK176",
"BLANK177",
"BLANK177b",
"REC",
"PLAY",
"FF",
"REW",
"PAUSE",
"PREV_KEYFRAME",
"NEXT_KEYFRAME",
"PLAY_AUDIO",
"PLAY_REVERSE",
"PREVIEW_RANGE",
"BLANK180",
"PMARKER_ACT",
"PMARKER_SEL",
"PMARKER",
"MARKER_HLT",
"MARKER",
"SPACE2", 
"SPACE3", 
"KEYINGSET",
"KEY_DEHLT",
"KEY_HLT",
"MUTE_IPO_OFF",
"MUTE_IPO_ON",
"VISIBLE_IPO_OFF",
"VISIBLE_IPO_ON",
"DRIVER",
"SOLO_OFF",
"SOLO_ON",
"FRAME_PREV",
"FRAME_NEXT",
"BLANK186",
"BLANK187",
"BLANK188",
"BLANK189",
"BLANK190",
"BLANK191",
"BLANK192",
"BLANK193",
"BLANK194",
"BLANK195",
"BLANK196",
"BLANK197",
"BLANK198",
"BLANK199",
"BLANK200",
"BLANK201",
"BLANK202",
"BLANK203",
"BLANK204",
"BLANK205",
"BLANK206",
"BLANK207",
"VERTEXSEL",
"EDGESEL",
"FACESEL",
"BLANK209",
"BLANK210",
"ROTATE",
"CURSOR",
"ROTATECOLLECTION",
"ROTATECENTER",
"ROTACTIVE",
"ALIGN",
"BLANK211",
"SMOOTHCURVE",
"SPHERECURVE",
"ROOTCURVE",
"SHARPCURVE",
"LINCURVE",
"NOCURVE",
"RNDCURVE",
"PROP_OFF",
"PROP_ON",
"PROP_CON",
"BLANK212",
"PARTICLE_POINT",
"PARTICLE_TIP",
"PARTICLE_PATH",
"MAN_TRANS",
"MAN_ROT",
"MAN_SCALE",
"MANIPUL",
"SNAP_OFF",
"SNAP_ON",
"SNAP_NORMAL",
"SNAP_INCREMENT",
"SNAP_VERTEX",
"SNAP_EDGE",
"SNAP_FACE",
"SNAP_VOLUME",
"BLANK220",
"STICKY_UVS_LOC",
"STICKY_UVS_DISABLE",
"STICKY_UVS_VERT",
"CLIPUV_DEHLT",
"CLIPUV_HLT",
"SNAP_PEEL_OBJECT",
"GRID",
"BLANK221",
"BLANK222",
"BLANK224",
"BLANK225",
"BLANK226",
"BLANK226b",
"PASTEDOWN",
"COPYDOWN",
"PASTEFLIPUP",
"PASTEFLIPDOWN",
"BLANK227",
"BLANK228",
"BLANK229",
"BLANK230",
"SNAP_SURFACE",
"BLANK232",
"BLANK233",
"RETOPO",
"UV_VERTEXSEL",
"UV_EDGESEL",
"UV_FACESEL",
"UV_ISLANDSEL",
"UV_SYNC_SELECT",
"BLANK240",
"BLANK241",
"BLANK242",
"BLANK243",
"BLANK244",
"BLANK245",
"BLANK246",
"BLANK247",
"BLANK247b",
"BBOX",
"WIRE",
"SOLID",
"SMOOTH",
"POTATO",
"BLANK248",
"ORTHO",
"BLANK249",
"BLANK250",
"LOCKVIEW_OFF",
"LOCKVIEW_ON",
"BLANK251",
"AXIS_SIDE",
"AXIS_FRONT",
"AXIS_TOP",
"NDOF_DOM",
"NDOF_TURN",
"NDOF_FLY",
"NDOF_TRANS",
"LAYER_USED",
"LAYER_ACTIVE",
"BLANK254",
"BLANK255",
"BLANK256",
"BLANK257",
"BLANK257b",
"BLANK258",
"BLANK259",
"BLANK260",
"BLANK261",
"BLANK262",
"BLANK263",
"BLANK264",
"BLANK265",
"BLANK266",
"BLANK267",
"BLANK268",
"BLANK269",
"BLANK270",
"BLANK271",
"BLANK272",
"BLANK273",
"BLANK274",
"BLANK275",
"BLANK276",
"BLANK277",
"BLANK278",
"BLANK279",
"BLANK280",
"BLANK281",
"BLANK282",
"BLANK282b",
"SORTALPHA",
"SORTBYEXT",
"SORTTIME",
"SORTSIZE",
"LONGDISPLAY",
"SHORTDISPLAY",
"GHOST",
"IMGDISPLAY",
"SAVE_AS",
"SAVE_COPY",
"BOOKMARKS",
"FONTPREVIEW",
"FILTER",
"NEWFOLDER",
"OPEN_RECENT",
"FILE_PARENT",
"FILE_REFRESH",
"FILE_FOLDER",
"FILE_BLANK",
"FILE_BLEND",
"FILE_IMAGE",
"FILE_MOVIE",
"FILE_SCRIPT",
"FILE_SOUND",
"FILE_FONT",
"FILE_TEXT",
"RECOVER_AUTO",
"SAVE_PREFS",
"LINK_BLEND",
"APPEND_BLEND",
"IMPORT",
"EXPORT",
"EXTERNAL_DATA",
"LOAD_FACTORY",
"BLANK300",
"BLANK301",
"BLANK302",
"BLANK303",
"BLANK304",
"LOOP_BACK",
"LOOP_FORWARDS",
"BACK",
"FORWARD",
"BLANK309",
"BLANK310",
"BLANK311",
"BLANK312",
"BLANK313",
"BLANK314",
"BLANK315",
"BLANK316",
"DISK_DRIVE",
"MATPLANE",
"MATSPHERE",
"MATCUBE",
"MONKEY",
"HAIR",
"ALIASED",
"ANTIALIASED",
"MAT_SPHERE_SKY",
"BLANK319",
"BLANK320",
"BLANK321",
"BLANK322",
"WORDWRAP_OFF",
"WORDWRAP_ON",
"SYNTAX_OFF",
"SYNTAX_ON",
"LINENUMBERS_OFF",
"LINENUMBERS_ON",
"SCRIPTPLUGINS",
"BLANK323",
"BLANK324",
"BLANK325",
"BLANK326",
"BLANK327",
"BLANK328",
"BLANK328b",
"SEQ_SEQUENCER",
"SEQ_PREVIEW",
"SEQ_LUMA_WAVEFORM",
"SEQ_CHROMA_SCOPE",
"SEQ_HISTOGRAM",
"SEQ_SPLITVIEW",
"BLANK331",
"BLANK332",
"BLANK333",
"IMAGE_RGB",
"IMAGE_RGB_ALPHA",
"IMAGE_ALPHA",
"IMAGE_ZDEPTH",
"IMAGEFILE",
"BLANK336",
"BLANK337",
"BLANK338",
"BLANK339",
"BLANK340",
"BLANK341",
"BLANK342",
"BLANK343",
"BLANK344",
"BLANK345",
"BLANK346",
"BLANK346b"]

def icon_mn_to_index(m,n):
    index = n*26 + m
    return index

def icon_index_to_pixel_array(index,icon_source):
    if index != 0:
        m = int(math.fmod(index,26))
    else:
        m = 0
    n = int(math.floor(index/26))
    
    
    #print('the m x n value is %s' % str([m,n]))
    #the bottom left corner pixel...
    #x = midpoint of first block + n*width of blocks -16 pixels, -1 for indexing?
    #y = the number of blocks, - 1/2 a bloc, - 16 pixels + offset of 
    x = 26 + m*42 - 16
    y = 26 + n*42 - 16
    
    #print('the x y value is %s' % str([x,y]))

    img_width = 1204
    img_array = [0]*32*32*4
    
    for i in range(0,32):
        
        start = 4*((y+i)*img_width + x)
        end = start + 32*4
        
        #print(start)
        #print(end)
        
        img_array[i*32*4:(i+1)*32*4] = icon_source.pixels[start:end]


    return img_array

def icon_to_blend_data(icon_name):
    if icon_name not in icon_list:
        icon_index = 2 #the error icon ;)
    else:
        icon_index = icon_list.index(icon_name)
    source_img = bpy.data.images.get("blender_icons_x2.png")    
    
    if icon_name in bpy.data.images:
        img = bpy.data.images[icon_name]
    
    else:
        img_array = icon_index_to_pixel_array(icon_index,source_img)
        img = bpy.data.images.new(icon_name,32,32)
        img.pixels = img_array
    
    return img

def icon_name_to_texture_coord(icon_name):
    
    if icon_name not in icon_list:
        ic_index = 2 #the error icon ;)
    else:
        ic_index = icon_list.index(icon_name)
        
    width = 1204
    height = 1280

    if ic_index != 0:
        m = int(math.fmod(ic_index,26))
    else:
        m = 0
    n = int(math.floor(ic_index/26))
    
    
    #print('the m x n value is %s' % str([m,n]))
    #the bottom left corner pixel...
    #x = midpoint of first block + n*width of blocks -16 pixels, -1 for indexing?
    #y = the number of blocks, - 1/2 a bloc, - 16 pixels + offset of 
    x = 26 + m*42 - 16
    y = 26 + n*42 - 16
    
    tex_coords = [(0,0)]*4
    
    x0 = round(x/width,4)
    x1 = round((x+32)/width,4)
    y0 = round(y/height,4)
    y1 = round((y+32)/height,4)
    
    
    tex_coords[0] = (x0,y0)
    tex_coords[1] = (x0,y1)
    tex_coords[2] = (x1,y1)
    tex_coords[3] = (x1,y0)
    return tex_coords
    
    
def load_icon_gl_named_textures(icon_list):

    #gl load source image so we can copy stuff out of it's texture
    img_source = bpy.data.images.get("blender_icons_x2.png")
    img_source.gl_load()
    
    #allocate texture list
    n = len(icon_list)
    #tex_array = bgl.GL_INT*n #do we need this?
    bgl.glGenTextures(n,tex_array)
    
    #copy appropriate pixels into the icon textures
    for i in range(0,n):
        print('nothing')
    
    
def clean_icon_texture():
    print('cleaning the texture')
    settings = context.user_prefernces.addons['piemenus'].preferences
    tex_name = settings.pieIconBindcode
    residencies = None
    bgl.glAreTexturesResident(1, tex_name, residencies)
    if residencies:
        bgl.glDeleteTextures(1, tex_name)

 
    
